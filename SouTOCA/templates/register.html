<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../static/favicon.png" type="image/png">
    <title>Cadastrar-se</title>
    <link rel="stylesheet" href="../static/registerStyle.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css"
        integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

</head>

<body>

    <div class="content">
        <div class="formulario">
            <div class="headerContent" style="height: 10%;">
                <img class="imgLogo" src="../static/Logo.png" alt="">
            </div>
            <div class="media">
                <h1 style="font-weight: bold; color: black; font-family: 'Roboto', sans-serif; font-size: 38pt;" class="mb-3">Cadastrar-se
                </h1>
                <h5 style="font-family: 'Roboto', sans-serif;" class="mb-5">Entre agora para a melhor torcida dos IFs</h5>
                
                <!-- Adicionar o token CSRF -->
                <form class="forms" style="width: 65%;" id="registerForm" method="POST">
                    {% csrf_token %}

                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="name" placeholder="Nome do usuário">
                        <label for="name">Nome do usuário</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="email" placeholder="Endereço de Email">
                        <label for="email">Endereço de Email</label>
                    </div>
                    <div style="display: flex;" class="mb-3 form-floating">
                        
                        <input style="display: flex; border-radius: 0px 0px 0px 10px;" 
                            type="password" 
                            class="form-control rounded-start" 
                            id="floatingPassword"
                            placeholder="Senha">
                        <label style="display: flex;" for="password">Senha</label>

                        <span style="width: 10%; border-radius: 0px 0px 10px;" 
                            class="input-group-text rounded-end">
                            <img style="width: 100%; cursor: pointer;" 
                                class="fa fa-eye" 
                                id="togglePassword" 
                                src="../static/viewPassword.png" 
                                alt="">
                        </span>
                    </div>

                    <button style="background-color: black; border-color: black;" type="button" id="registerBtn" class="mb-3 btn btn-success">Cadastrar-se</button>
                </form>                
            </div>
            <div class="mb-4 footer"
                style="height: 10%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <img class="mb-1" style="width: 4%;" src="../static/Logo_IFRN.png" alt="">
                <p style="margin: 0; font-weight: 500;">Instituto Federal do Rio Grande do Norte</p>
                <p style="margin: 0; font-weight: 500;">Campus Caicó </p>
            </div>
        </div>
        <div class="logo"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const togglePassword = document.querySelector("#togglePassword");
            const password = document.querySelector("#floatingPassword");
    
            togglePassword.addEventListener("click", function () {
                const type = password.getAttribute("type") === "password" ? "text" : "password";
                password.setAttribute("type", type);
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
    
            document.getElementById("registerBtn").addEventListener("click", function () {
                const name = document.getElementById("name").value;
                const email = document.getElementById("email").value;
                const password = document.getElementById("floatingPassword").value;
    
                fetch('/register/', {  // Adicione a barra no final do URL
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'  // Verifique se isso é necessário em seu contexto
                    },
                    body: JSON.stringify({
                        'name': name,
                        'email': email,
                        'password': password
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        alert('Usuário registrado com sucesso!');
                        window.location.href = '/login';  // Redireciona para a página de login
                    } else {
                        alert('Erro ao registrar usuário: ' + data.message);
                    }
                })
                .catch(error => console.error('Erro:', error));
            });
        });
    </script>
    

</body>

</html>
